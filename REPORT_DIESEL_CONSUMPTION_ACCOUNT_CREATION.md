# تقرير إنشاء حساب استهلاك الديزل غليل

**التاريخ**: 2026-01-16  
**المهمة**: إنشاء حساب محاسبي لاستهلاك الديزل في فرع غليل

---

## الملخص التنفيذي

تم إنشاء حساب محاسبي جديد باسم **"استهلاك الديزل غليل"** في شجرة الحسابات تحت "المصاريف التشغيلية". هذا الحساب سيتم استخدامه لتسجيل استهلاك الديزل في فرع غليل عند صرف الديزل من المخزن.

---

## تفاصيل الحساب المُنشأ

### معلومات الحساب الأساسية

- **الاسم**: استهلاك الديزل غليل
- **الرمز**: 8550
- **النوع**: مصروفات (Expense)
- **المستوى**: 2
- **الحساب الأب**: المصاريف التشغيلية (12351)
- **حساب رئيسي/فرعي**: حساب فرعي (isGroup: false)
- **الوحدة**: وحدة أعمال الحديدة (UNIT-001)
- **الرصيد الحالي**: 0.00 ر.ي

---

## هيكل الحسابات لاستهلاك الديزل

تحت "المصاريف التشغيلية" (12351) يوجد الآن **3 حسابات** لاستهلاك الديزل:

| الرمز    | الاسم                   | النوع   | الوضع    |
| -------- | ----------------------- | ------- | -------- |
| 845      | استهلاك الديزل الصبالية | مصروفات | موجود    |
| 8545     | استهلاك الديزل الدهمية  | مصروفات | موجود    |
| **8550** | **استهلاك الديزل غليل** | مصروفات | **جديد** |

---

## الاستخدام في النظام

### كيفية استخدام الحساب

عند صرف الديزل من المخزن في صفحة **حركات المخزون** (`StockMovements.tsx`):

1. إنشاء حركة صادر جديدة:
   - نوع الحركة: **صادر (out)**
   - الصنف: الديزل
   - المستودع: مستودع المحطة
   - الكمية: الكمية المراد صرفها

2. اختيار حساب الصرف:
   - **حساب الصرف (toAccountId)**: **8550 - استهلاك الديزل غليل**

3. **تلقائياً** يتم:
   - ✅ تقليل الكمية في المخزن
   - ✅ إنشاء قيد محاسبي:
     - مدين: حساب استهلاك الديزل غليل (8550)
     - دائن: حساب المخزون
   - ✅ تحديث رصيد حساب استهلاك الديزل غليل

---

## القيود المحاسبية التلقائية

عند صرف الديزل لحساب "استهلاك الديزل غليل":

```
مدين: حساب استهلاك الديزل غليل (8550)
دائن: حساب المخزون (Stock Account)
```

هذا القيد يتم إنشاؤه تلقائياً من قبل النظام عند إنشاء حركة صادر من نوع `out` مع تحديد `toAccountId`.

---

## مثال على الاستخدام

### مثال: صرف 1000 لتر ديزل للاستهلاك في غليل

1. **حركة صادر**:
   - الصنف: ديزل
   - المستودع: مستودع المحطة
   - الكمية: 1000 لتر
   - سعر التكلفة: 450 ر.ي/لتر (بناءً على آخر سعر شراء)
   - الإجمالي: 450,000 ر.ي
   - حساب الصرف: **8550 - استهلاك الديزل غليل**

2. **ما يتم إنشاؤه تلقائياً**:
   - ✅ تقليل المخزون: -1000 لتر
   - ✅ قيد محاسبي تلقائي:
     - مدين: استهلاك الديزل غليل (8550) - 450,000 ر.ي
     - دائن: المخزون - 450,000 ر.ي

3. **النتيجة**:
   - رصيد حساب استهلاك الديزل غليل: 450,000 ر.ي (مدين)
   - المخزون ينخفض بمقدار 1000 لتر

---

## الحسابات المتاحة للصرف

بعد إنشاء الحساب الجديد، أصبح لديك **3 حسابات** لصرف الديزل حسب الفرع:

1. **845** - استهلاك الديزل الصبالية
   - للصرف في فرع الصبالية

2. **8545** - استهلاك الديزل الدهمية
   - للصرف في فرع الدهمية

3. **8550** - استهلاك الديزل غليل ⭐ **جديد**
   - للصرف في فرع غليل

---

## التحقق من الحساب

### في واجهة المستخدم

1. انتقل إلى صفحة **شجرة الحسابات** (`/coa`)
2. افتح "المصاريف التشغيلية" (12351)
3. ستجد الحسابات الثلاثة:
   - استهلاك الديزل الصبالية (845)
   - استهلاك الديزل الدهمية (8545)
   - **استهلاك الديزل غليل (8550)** ⭐

### عبر API

```http
GET /api/accounts/8550
```

أو للحصول على جميع حسابات استهلاك الديزل:

```http
GET /api/accounts?entityId=UNIT-001
```

ثم تصفية الحسابات التي `parentId = '12351'` و `id IN ('845', '8545', '8550')`

---

## الملفات المتأثرة

لا توجد ملفات تم تعديلها لهذه المهمة - تم إنشاء الحساب مباشرة عبر API وتم حفظه في قاعدة البيانات.

### الملفات ذات الصلة (غير معدلة)

- `server/db/schema.ts`: يحتوي على تعريف جدول `accounts`
- `server/routes/accounts.ts`: يحتوي على API endpoints لإدارة الحسابات
- `server/routes/stockMovements.ts`: يحتوي على منطق إنشاء القيود المحاسبية عند الصرف
- `client/src/pages/ChartOfAccounts.tsx`: واجهة عرض شجرة الحسابات
- `client/src/pages/StockMovements.tsx`: واجهة إنشاء حركات المخزون والصرف

---

## الخطوات المتبعة

1. ✅ فتح صفحة شجرة الحسابات
2. ✅ تحديد الحساب الأب: المصاريف التشغيلية (12351)
3. ✅ إنشاء الحساب الجديد عبر API:
   - الرمز: 8550
   - الاسم: استهلاك الديزل غليل
   - النوع: expense
   - الحساب الأب: 12351
   - الوضع: حساب فرعي
4. ✅ تحديث اسم الحساب (إذا لزم الأمر)
5. ✅ التحقق من ظهور الحساب في الواجهة

---

## الحالة الحالية

- ✅ **الحساب موجود**: نعم
- ✅ **يظهر في الواجهة**: نعم
- ✅ **جاهز للاستخدام**: نعم
- ✅ **مربوط بالحساب الأب**: نعم (المصاريف التشغيلية)

---

## التوصيات

1. **الاستخدام الفوري**: يمكن استخدام الحساب مباشرة في صفحة حركات المخزون عند صرف الديزل.

2. **التوثيق**: تم توثيق عملية الشراء والصرف في ملف `WORKFLOW_DIESEL_PURCHASE.md`.

3. **التقارير**: يمكن إنشاء تقارير عن استهلاك الديزل لكل فرع من خلال:
   - صفحة دفتر الأستاذ (`/ledger`)
   - اختيار الحساب المطلوب (845, 8545, أو 8550)

4. **التحقق الدوري**: يُنصح بالتحقق من صحة القيود المحاسبية التلقائية بعد كل عملية صرف.

---

## الخلاصة

تم إنشاء حساب **"استهلاك الديزل غليل"** بنجاح وتم التحقق من ظهوره في شجرة الحسابات. الحساب جاهز للاستخدام الفوري في عمليات صرف الديزل من المخزن في فرع غليل.

---

**تم الإنجاز بواسطة**: AI Assistant  
**التاريخ**: 2026-01-16  
**الوقت**: تم الإنجاز
