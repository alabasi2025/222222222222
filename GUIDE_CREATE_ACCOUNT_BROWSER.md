# دليل إنشاء حساب استهلاك الديزل من واجهة المتصفح

**التاريخ**: 2026-01-16  
**الغرض**: خطوات إنشاء حساب محاسبي جديد من واجهة المستخدم

---

## الخطوات التفصيلية

### 1. فتح صفحة شجرة الحسابات

1. افتح المتصفح وانتقل إلى الرابط:

   ```
   http://localhost:10002/coa
   ```

   أو من القائمة الجانبية:
   - النظام المالي → الحسابات والقيود → شجرة الحسابات

2. انتظر حتى يتم تحميل جميع الحسابات (سترى "جاري تحميل الحسابات..." ثم تختفي)

---

### 2. إنشاء حساب جديد

1. انقر على زر **"حساب جديد"** في الأعلى (بجانب زر "فتح الكل")
   - ستفتح نافذة منبثقة بعنوان "إضافة حساب جديد"

---

### 3. تعبئة بيانات الحساب

في النافذة المنبثقة، قم بتعبئة الحقول التالية:

#### أ) اسم الحساب

- في حقل **"اسم الحساب"**:
  - أدخل: `استهلاك الديزل غليل`

#### ب) رمز الحساب

- في حقل **"رمز الحساب"**:
  - أدخل: `8550`

#### ج) نوع الحساب

1. انقر على القائمة المنسدلة **"نوع الحساب"**
2. من القائمة، اختر: **"مصروفات"**
   - (الخيارات: أصول، خصوم، حقوق ملكية، إيرادات، **مصروفات**)

#### د) الحساب الأب

1. انقر على القائمة المنسدلة **"الحساب الأب"**
2. من القائمة، اختر: **"المصاريف التشغيلية"**
   - (إذا لم ترها مباشرة، ابحث عنها - رمزها: 12351)

#### هـ) نوع الحساب (رئيسي/فرعي)

- في قسم **"هل هذا حساب رئيسي (مجموعة)؟"**:
  - اختر: **"حساب فرعي"** (Radio button الثاني)
  - ⚠️ **مهم**: يجب اختيار "حساب فرعي" وليس "حساب رئيسي"

#### و) العملات (اختياري - الإعدادات الافتراضية كافية)

- يمكنك ترك الإعدادات الافتراضية:
  - YER ✅
  - SAR ✅
  - USD ✅

---

### 4. حفظ الحساب

1. بعد تعبئة جميع الحقول المطلوبة:
   - ✅ اسم الحساب: `استهلاك الديزل غليل`
   - ✅ رمز الحساب: `8550`
   - ✅ نوع الحساب: `مصروفات`
   - ✅ الحساب الأب: `المصاريف التشغيلية`
   - ✅ نوع الحساب: `حساب فرعي`

2. انقر على زر **"حفظ"** في أسفل النافذة
   - ستظهر رسالة نجاح: "تم إضافة الحساب بنجاح"
   - النافذة ستُغلق تلقائياً

---

### 5. التحقق من الحساب

#### أ) البحث عن الحساب في القائمة

1. في صفحة شجرة الحسابات، ابحث عن حساب **"المصاريف التشغيلية"** (12351)

2. انقر على الزر بجانبه لـ **"فتح"** أو **"إظهار الحسابات الفرعية"**:
   - ستظهر الحسابات الفرعية، منها:
     - استهلاك الديزل الصبالية (845)
     - استهلاك الديزل الدهمية (8545)
     - **استهلاك الديزل غليل (8550)** ⭐ **جديد**

#### ب) البحث بالاسم أو الرمز

1. في حقل البحث في الأعلى، اكتب:
   - `8550` (رمز الحساب)، أو
   - `غليل` (جزء من الاسم)

2. ستظهر النتائج التي تطابق البحث

---

## صورة توضيحية للبيانات المطلوبة

```
┌─────────────────────────────────────────┐
│      إضافة حساب جديد                   │
├─────────────────────────────────────────┤
│                                         │
│  اسم الحساب:                           │
│  ┌─────────────────────────────────┐   │
│  │ استهلاك الديزل غليل            │   │
│  └─────────────────────────────────┘   │
│                                         │
│  رمز الحساب:                            │
│  ┌─────────────────────────────────┐   │
│  │ 8550                            │   │
│  └─────────────────────────────────┘   │
│                                         │
│  نوع الحساب:                            │
│  ┌─────────────────────────────────┐   │
│  │ ▼ مصروفات                      │   │
│  └─────────────────────────────────┘   │
│                                         │
│  الحساب الأب:                           │
│  ┌─────────────────────────────────┐   │
│  │ ▼ المصاريف التشغيلية           │   │
│  └─────────────────────────────────┘   │
│                                         │
│  هل هذا حساب رئيسي (مجموعة)؟           │
│  ○ حساب رئيسي (مجموعة)                │
│  ● حساب فرعي                           │ ← اختار هذا
│                                         │
│  العملات المسموح بها:                  │
│  ☑ YER  ☑ SAR  ☑ USD                  │
│                                         │
│  ┌──────────┐  ┌──────────┐           │
│  │ إلغاء    │  │  حفظ     │           │ ← اضغط هنا
│  └──────────┘  └──────────┘           │
└─────────────────────────────────────────┘
```

---

## الأخطاء الشائعة وحلولها

### ❌ خطأ: "لا يمكن إضافة حساب فرعي لحساب ليس رئيسياً (مجموعة)"

**السبب**: حاولت إضافة حساب فرعي تحت حساب ليس مجموعة (isGroup = false)

**الحل**:

- تأكد أن الحساب الأب (المصاريف التشغيلية) هو حساب رئيسي
- إذا لم يكن كذلك، يجب تعديله أولاً ليكون حساب رئيسي

### ❌ خطأ: "يرجى تعبئة جميع الحقول المطلوبة"

**السبب**: لم تقم بتعبئة أحد الحقول المطلوبة (الاسم أو الرمز)

**الحل**:

- تأكد من تعبئة **اسم الحساب** و **رمز الحساب**
- تأكد أن الحقول غير فارغة

### ❌ خطأ: "رمز الحساب موجود مسبقاً"

**السبب**: حاولت استخدام رمز حساب موجود بالفعل (مثل 8550 إذا كان موجوداً)

**الحل**:

- استخدم رمز حساب مختلف (مثل: 8551، 8552، إلخ)
- أو احذف الحساب القديم أولاً إذا كنت تريد إعادة استخدام الرمز

---

## الاختبار الكامل

### اختبار 1: إنشاء الحساب

1. ✅ افتح صفحة شجرة الحسابات
2. ✅ انقر على "حساب جديد"
3. ✅ املأ البيانات:
   - الاسم: استهلاك الديزل غليل
   - الرمز: 8550 (أو أي رمز متاح)
   - النوع: مصروفات
   - الحساب الأب: المصاريف التشغيلية
   - نوع الحساب: حساب فرعي
4. ✅ انقر على "حفظ"
5. ✅ تحقق من ظهور رسالة النجاح

### اختبار 2: التحقق من الحساب

1. ✅ افتح "المصاريف التشغيلية" في شجرة الحسابات
2. ✅ تحقق من ظهور الحساب الجديد في القائمة
3. ✅ تحقق من البيانات:
   - ✅ الاسم صحيح
   - ✅ الرمز صحيح
   - ✅ النوع: مصروفات
   - ✅ الحساب الأب: المصاريف التشغيلية

### اختبار 3: استخدام الحساب في حركة صرف

1. ✅ افتح صفحة **حركات المخزون** (`/stock-movements`)
2. ✅ أنشئ حركة صادر جديدة:
   - نوع: صادر (out)
   - الصنف: الديزل
   - المستودع: اختار مستودع
   - الكمية: 100 لتر (مثال)
   - **حساب الصرف (toAccountId)**: اختار "8550 - استهلاك الديزل غليل"
3. ✅ احفظ الحركة
4. ✅ تحقق من:
   - ✅ تقليل المخزون
   - ✅ إنشاء قيد محاسبي في القيود اليومية

---

## نصائح مفيدة

1. **ترقيم الحسابات**: استخدم ترقيم متسلسل للحسابات المتشابهة:
   - 845: استهلاك الديزل الصبالية
   - 8545: استهلاك الديزل الدهمية
   - 8550: استهلاك الديزل غليل

2. **الأسماء الوصفية**: استخدم أسماء واضحة تصف الحساب بدقة

3. **التحقق قبل الحفظ**: راجع جميع البيانات قبل الضغط على "حفظ"

4. **البحث السريع**: استخدم حقل البحث للعثور على الحسابات بسرعة

---

## الخطوات السريعة (Cheat Sheet)

```
1. افتح: http://localhost:10002/coa
2. اضغط: "حساب جديد"
3. املأ:
   - الاسم: استهلاك الديزل غليل
   - الرمز: 8550
   - النوع: مصروفات
   - الأب: المصاريف التشغيلية
   - الوضع: حساب فرعي
4. اضغط: "حفظ"
5. تحقق من: فتح "المصاريف التشغيلية" وستجد الحساب الجديد
```

---

**تاريخ الإنشاء**: 2026-01-16  
**آخر تحديث**: 2026-01-16
